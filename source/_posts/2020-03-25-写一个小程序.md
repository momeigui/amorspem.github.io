---
title: 查询并保存电脑已安装软件
date: 2020-03-21 10:10:00
tags: [教程, 计算机]
categories: 
	- [计算机]
index_img: https://pic.imgdb.cn/item/5e7af606504f4bcb04bc1d49.jpg
banner_img: https://pic.imgdb.cn/item/5e7af606504f4bcb04bc1d49.jpg
---

将电脑安装的所有软件的安装时间，版本，名称全部记录到表格

### 思路

思路其实很简单

读取系统信息 ---> 处理数据 ---> 生成表格

但是有多台计算机，所以还有封装与分发。

### 开始

#### 获取数据

- 有通过注册表，有通过`cmd`命令的。

- 有的数据不全，搞到头大。

- 最后通过WMI获得系统安装的软件，能获取到信息就行~

```powershell
Get-WmiObject Win32_Product | Format-List Caption,Description,IdentifyingNumber,InstallDate,InstallLocation,HelpLink,HelpTelephone,InstallSource,Language,LocalPackage,Name,PackageCache,PackageCode,PackageName,ProductID,RegOwner,RegCompany,SKUNumber,Transforms,URLInfoAbout,URLUpdateInfo,Vendor,WordCount,Version
```


#### 将数据传递到`node.js`中。。

- 一开始我试图保存文件再通过文件传过去，但是很明显，太麻烦了。

- 于是我找了一个在`node`中运行`powershell`命令的模块`node-powershell`。

```javascript
//基本用法，快速开始
const shell = require('node-powershell');

let ps = new shell({
executionPolicy: 'Bypass',
noProfile: true
});

ps.addCommand('echo node-powershell')
ps.invoke()
.then(output => {
console.log(output);
})
.catch(err => {
console.log(err);
ps.dispose();
});
```

#### 在`node`中格式化数据

- 将字符串格式化整理为可用数据。

- 没找到什么好方法，只能用`replace()`疯狂修改，有些地方没有通用性，但我又想不到更好的方法。很烦。

- 将字符串先转为`json`数据，然后转化为对象，最终输出为一个二维数组，为接下来准备。

```javascript
var ttt = '['+data.replace(/\r/g,"\",\"")
.replace(/\n/g,"\",\"")
.replace(/\,\"\"\,/g,'\,')
.replace(/\,\"\"\,/g,'}\,{')
.replace(/:/g,'\":\"')
.replace(/Name        /g,'Name')
.replace(/InstallDate /g,'InstallDate')
.replace(/Version     /g,'Version')
.slice(3,-8)+']';
var obj = JSON.parse(ttt);
//很蠢。。。但我没啥更好的办法了。。。
```

- 现在只差将数据输出了~

#### 数据输出

- 因为我想直接输出表格数据，所以找到了个模块`node=xlsx`，简单好用。
- 将二维数组直接利用`xlsx`直接写入文件即可。

#### 打包分发

- 由于不是我使用，并且还在别的电脑上使用，所以我找到了`node`打包软件`pkg`，可以直接将node.js项目打包成`windows`可以直接执行的`exe`文件（也支持`FreeBSD`、`linux`、`macos`、`arm`系统），甚至不需要安装`Node.js`，且无须修改你项目中的任何代码！

- 嗯~ o(*￣▽￣*)o，这就是我想要的，哈哈~

## 收获

- 哈哈~ 相当开心，虽然才看了两天的`node`教程，但是捣鼓出来了一个可以用的`exe`文件，那是相当的爽~
- 也学习了很多东西，虽然，很多都是在乱来~哈哈
- 文件下载地址 [查询电脑已安装软件](https://www.lanzous.com/iamho7a)的软件。。。

## 问题

- 软件列表不全，只能查询到，安装包由Windows Installer制作，安装过程中调用Windows Installer服务进行安装的软件。
- 关于遍历注册表，但是我发现注册表也显示的不全，有些软件并不在这些路径下。

```javascript
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall
HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall
```

- 好像还是要，遍历注册表来搞。。。。。自闭。。。

------



> 参考文档
>
> [node-powershell](https://cloud.tencent.com/developer/article/1402355)
>
> [node-xlsx](https://blog.csdn.net/qq_29594393/article/details/57413815)
>
> [pkg](https://www.cnblogs.com/mordom/p/8337337.html)



